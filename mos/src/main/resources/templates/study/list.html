<div data-th-replace="header::header">머리말</div>
<div class="container page-margin wrapper-mos">
    <h1>스터디 모집 목록</h1>
    <table id="studyTable" class="table table-striped">
        <thead>
        <tr>
            <th>번호</th>
            <th>제목</th>
            <th>스터디장</th>
            <th>정원</th>
            <th>방법</th>
            <th>마감일</th>
            <th>태그</th>
        </tr>
        </thead>
        <tbody>
        <!-- 여기에 JavaScript로 데이터를 삽입할 예정 -->
        </tbody>
    </table>
    <div class="text-center">
        <div id="loader" class="spinner-border text-primary" role="status" style="display: none;">
            <span class="sr-only">Loading...</span>
        </div>
    </div>

    <script data-th-inline="javascript">
        let page = 0;
        const size = 20;

        function loadStudies() {
            $.ajax({
                url: '/study/api/v1/list',
                data: {
                    page: page,
                    size: size
                },
                success: function(data) {
                    const studyList = data.content;
                    const tbody = $('#studyTable tbody');
                    studyList.forEach(function(study) {
                        const row = $('<tr></tr>');

                        row.append('<td>' + study.studyNo + '</td>');
                        row.append('<td>' + study.title + '</td>');
                        row.append('<td>' + study.memberNo + '</td>');
                        row.append('<td>' + study.intake + '</td>');
                        row.append('<td>' + study.method + '</td>');
                        row.append('<td>' + study.recruitmentDeadline + '</td>');

                        const tagList = $('<td></td>');
                        study.tagList.forEach(function(tag) {
                            tagList.append('<span>' + tag.name + '</span>');
                        });
                        row.append(tagList);

                        tbody.append(row);
                    });

                    page++;

                    if (data.last) {
                        $(window).off('scroll'); // 마지막 페이지이면 스크롤 이벤트 해제
                    }
                }
            });
        }

        $(window).scroll(function() {
            if ($(window).scrollTop() + $(window).height() >= $(document).height()) {
                loadStudies();
            }
        });

        loadStudies(); // 초기 데이터 로드
    </script>
</div>
<div data-th-replace="footer::footer">꼬리말</div>


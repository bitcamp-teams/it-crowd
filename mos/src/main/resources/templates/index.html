<div data-th-replace="header::header">머리말</div>
<script>
    // window.location.href = '/study/card';
    // 회원가입 처리 위해서 redirect 하지 마세요!
</script>
<style>
    body {
        background: #f8f9fa;
    }

    .HomeLayout_block {
        display: flex;
        justify-content: center;
        flex-flow: row wrap;
    }

    .HomeLayout_block .HomeLayout_innerBlock {
        display: flex;
        margin: 0 auto;
        flex-flow: row wrap;
    }

    .HomeLayout_mainWrapper {
        width: 100%;
        margin-top: 32px;
        margin-bottom: 16px;
    }

    .grid_homeGrid {
        display: grid;
        grid-gap: 32px;
        padding: 0;
        margin: 0;
        --card-count: 5;
        --spacer: calc(var(--card-count) - 1);
        --width: 20%;
        grid-template-columns: repeat(var(--card-count), minmax(calc((var(--width) - (32px * var(--spacer) / var(--card-count))) * 0.8), 1fr));
    }

    @media screen and (max-width: 1919px) {
        .grid_homeGrid {
            --card-count: 4;
            --width: 25%;
        }
    }

    .PostCard_block {
        display: flex;
        flex-flow: column nowrap;
        width: 100%;
        background: #fff;
        border-radius: 4px;
        box-shadow: 0 4px 16px 0 rgba(0, 0, 0, .04);
        transition: box-shadow .25s ease-in, transform .25s ease-in;
    }

    .PostCard_block:hover {
        box-shadow: 0 8px 20px 0 rgba(0, 0, 0, .1); /* Adjust shadow values as needed */
        transform: translateY(-4px);
    }

    .PostCard_block .PostCard_styleLink {
        display: block;
        color: inherit;
        -webkit-text-decoration: none;
        text-decoration: none;
    }

    .RatioImage_block {
        width: 100%;
        position: relative;
    }

    .RatioImage_block img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: block;
        -o-object-fit: cover;
        object-fit: cover;
    }

    .PostCard_content {
        padding: 1rem;
        display: flex;
        flex: 1 1;
        flex-direction: column;
    }

    .PostCard_block .PostCard_styleLink {
        display: block;
        color: inherit;
        -webkit-text-decoration: none;
        text-decoration: none;
    }

    .PostCard_content .PostCard_h4 {
        font-size: 1rem;
        margin: 0 0 .25rem;
        line-height: 1.5;
        word-break: break-word;
        color: #212529;
    }

    .utils_ellipsis {
        text-overflow: ellipsis;
        white-space: nowrap;
        overflow-x: hidden;
        overflow-y: hidden;
    }

    .PostCard_content .PostCard_descriptionWrapper {
        flex: 1 1;
    }

    .PostCard_content p.PostCard_clamp {
        height: 3.9375rem;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .PostCard_content__W3lPm p {
        word-break: break-word;
        word-wrap: break-word;
        font-size: .875rem;
        line-height: 1.5;
        color: #495057;
        margin: 0 0 1.5rem;
    }

    .PostCard_content .PostCard_subInfo {
        margin-top: auto;
        font-size: .75rem;
        line-height: 1.5;
        color: #868e96;
    }

    .PostCard_content .PostCard_subInfo .PostCard_separator {
        margin-left: .25rem;
        margin-right: .25rem;
    }

    .PostCard_footer {
        padding: .625rem 1rem;
        border-top: 1px solid #f1f3f5;
        display: flex;
        font-size: .75rem;
        line-height: 1.5;
        justify-content: space-between;
    }

    .PostCard_footer .PostCard_userInfo {
        -webkit-text-decoration: none;
        text-decoration: none;
        color: inherit;
        display: flex;
        align-items: center;
    }

    .PostCard_footer .PostCard_userInfo img {
        -o-object-fit: cover;
        object-fit: cover;
        border-radius: 50%;
        width: 1.5rem;
        height: 1.5rem;
        display: block;
        margin-right: .5rem;
    }

    .PostCard_footer .PostCard_userInfo span {
        color: #868e96;
    }

    .PostCard_footer .PostCard_likes {
        display: flex;
        align-items: center;
        color: #212529;
    }

    .PostCard_footer .PostCard_likes svg {
        width: .75rem;
        height: .75rem;
        margin-right: .5rem;
    }
</style>
<div class=" page-margin wrapper-mos">
    <!--  <div data-th-replace="home/rtp_study::rtp_study">실시간 인기 스터디</div>-->
    <!--  <div data-th-replace="home/nearby_study::nearby_study">내 주변 스터디</div>-->
    <!--  <div data-th-replace="home/rtp_wiki::rtp_wiki">실시간 인기 글</div>-->
    <h1>스터디 모집 목록</h1>

    <div class="HomeLayout_block">
        <div class="HomeLayout_innerBlock">
            <div class="HomeLayout_mainWrapper">
                <ul class="PostCardGrid_block grid_homeGrid">

                    <li class="PostCard_block">
                        <!--  썸네일    -->
                        <a href="#" class="VLink_block PostCard_styleLink">
                            <div class="RatioImage_block" style="padding-top: 52.1921%;">
                                <img alt="FE 개발자의 모바일청첩장 post"
                                     fetchpriority="high"
                                     decoding="async"
                                     data-nimg="fill"
                                     src="https://picsum.photos/320/167"
                                     style="position: absolute; height: 100%; width: 100%; inset: 0px; color: transparent;">
                            </div>
                        </a>
                        <!--  본문   -->
                        <div class="PostCard_content">
                            <a href="#"
                               class="VLink_block PostCard_styleLink">
                                <h4 class="PostCard_h4 utils_ellipsis">FE 개발자의 모바일청첩장</h4>
                                <div class="PostCard_descriptionWrapper">
                                    <p class="PostCard_clamp">결혼하는 김에, 개발자의 특전이라는 모바일 청첩장 만들기 저도 해보았습니다.</p>
                                </div>
                            </a>
                            <div class="PostCard_subInfo"><span>2일 전</span>
                                <span class="PostCard_separator">·</span><span>10개의 댓글</span>
                            </div>
                        </div>
                        <!--   유저 프로필 이미지, 아이디, 좋아요    -->
                        <div class="PostCard_footer"><a class="PostCard_userInfo" href="/@heyday_xz/posts">
                            <img
                                    alt="user thumbnail of heyday.xz" loading="lazy" width="24" height="24"
                                    decoding="async"
                                    data-nimg="1"
                                    src="https://picsum.photos/24/24"
                                    style="color: transparent;"><span>by <b>heyday.xz</b></span></a>
                            <div class="PostCard_likes">
                                <svg viewBox="0 0 24 24">
                                    <path fill="currentColor" d="m18 1-6 4-6-4-6 5v7l12 10 12-10V6z"></path>
                                </svg>
                                66
                            </div>
                        </div>
                    </li>

                </ul>
            </div>
        </div>
    </div>

    <script data-th-inline="javascript">
        let page = 0;
        let isLastPage = false;
        let loading = false;

        function loadStudies() {
            if (!loading && !isLastPage) {
                loading = true;
                $.ajax({
                    url: '/study/api/v1/list',
                    data: {
                        page: page
                    },
                    success: function (data) {
                        if (data.last) {
                            isLastPage = true;
                        }
                        const studyList = data.content;
                        const cardsContainer = $('#studyCards');
                        studyList.forEach(function (study) {
                            const cardCol = $('<div class="col-md-4 col-sm-6 mb-4"></div>');
                            const card = $('<div class="card h-100"></div>');
                            const cardBody = $('<div class="card-body"></div>');
                            const cardTitle = $(
                                '<h5 class="card-title"><a href="/study/view?studyNo=' + study.studyNo + '">'
                                + study.title + '</a></h5>');
                            const cardText = $(
                                '<p class="card-text">' + study.leaderName + '<br>' + study.intake + '<br>'
                                + study.method + '<br>' + study.recruitmentDeadline + '<br>' + study.tags
                                + '<br>조회수: ' + study.hitCount + '<br>좋아요: ' + study.likeCount + '</p>');

                            cardBody.append(cardTitle, cardText);
                            card.append(cardBody);
                            cardCol.append(card);
                            cardsContainer.append(cardCol);
                        });

                        page++;

                        if (data.last) {
                            isLastPage = true;
                            $(document).off('scroll');
                        } else {
                            checkScrollPosition();
                        }
                    },
                    complete: function () {
                        loading = false;
                    }
                });
            }
        }

        function checkScrollPosition() {
            const scrollBottom = $(document).scrollTop() + $(window).height();
            if (scrollBottom >= $(document).height() * 0.9) {
                loadStudies();
            }
        }

        let debounceTimer;

        $(document).scroll(function () {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(checkScrollPosition, 400);
        });

        loadStudies();
    </script>
</div>

<div data-th-replace="footer::footer">꼬리말</div>

